<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    <mapper namespace="com.example.demo.admin.mapper.customers.CustomerMapper">
        <resultMap id="customerMapping" type="com.example.demo.admin.dto.customerDTO.CustomerDTO$Res">
            <id property="id" column="id"/>
            <result property="name" column="name"/>
            <result property="address" column="address"/>
            <result property="phoneNumber" column="phonenumber" />
            <result property="email" column="email"/>
            <result property="created_at" column="created_at"/>
        </resultMap>
    <select id="getCustomers" resultMap="customerMapping">
        SELECT * FROM customers
        <where>
            <if test="name!=null and name !=''">
                AND name LIKE CONCAT('%',#{name},'%')
            </if>
            <if test="email !=null and email !=''">
                AND email LIKE CONCAT('%',#{email},'%')
            </if>
            <if test="phoneNumber !=null and phoneNumber !=''">
                AND phonenumber LIKE CONCAT('%', #{phoneNumber},'%')
            </if>
        </where>
        ORDER BY id DESC
        <if test="maxResultCount != null and maxResultCount &gt; 0">
            LIMIT #{maxResultCount} OFFSET #{skipCount}
        </if>
    </select>
    <select id="countCustomers" resultType="long" parameterType="com.example.demo.admin.dto.customerDTO.CustomerDTO$Req">
        SELECT COUNT(*)
        FROM customers
        <where>
            <if test="name!=null and name !=''">
                AND name LIKE CONCAT('%',#{name},'%')
            </if>
            <if test="email !=null and email !=''">
                AND email LIKE CONCAT('%',#{email},'%')
            </if>
            <if test="phoneNumber !=null and phoneNumber !=''">
                AND phonenumber LIKE CONCAT('%', #{phoneNumber},'%')
            </if>
        </where>
    </select>

    <select id="findCustomerById" resultType="com.example.demo.admin.dto.customerDTO.CustomerDTO$Res">
        select * from customers where id=#{id}::uuid
    </select>

    <insert id="addCustomer" parameterType="com.example.demo.admin.dto.customerDTO.CustomerDTO$Body">
        INSERT INTO customers(name,email,phonenumber,address) VALUES(#{name}, #{email}, #{phoneNumber}, #{address})
    </insert>
    <delete id="deleteCustomer" parameterType="String">
        DELETE FROM customers where id=#{id}::uuid
    </delete>
    </mapper>